---
let errorMessage = "";
let successMessage = "";

// Esta función maneja el envío del formulario y validación
function handleSubmit(event: Event) {
  event.preventDefault();
  errorMessage = "";
  successMessage = "";

  const form = event.target;

  // Obtener los valores del formulario
  const fullName = (form as HTMLFormElement)?.fullName?.value || '';
  const phone = (form as HTMLFormElement)?.phone?.value;
  const email = (form as HTMLFormElement)?.email?.value;
  const branch = (form as HTMLFormElement)?.branch?.value || '';
  const model = (form as HTMLFormElement)?.model?.value;
  const date = (form as HTMLFormElement)?.date?.value;

  // Validar los campos
  if (!fullName || !phone || !email || !branch || !model || !date) {
    errorMessage = "Todos los campos son obligatorios.";
    return;
  }

  // Validación básica de email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    errorMessage = "Por favor, ingrese un correo electrónico válido.";
    return;
  }

  // Enviar los datos a la API
  fetch("https://panelweb.derkayvargas.com/api/solicitar-test-drive/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ fullName, phone, email, branch, model, date }),
  })
    .then((response) => {
      if (!response.ok) {
        throw new Error("Error al enviar el formulario.");
      }
      successMessage = "Formulario enviado correctamente.";
      (form as HTMLFormElement)?.reset(); // Limpiar el formulario
    })
    .catch((error) => {
      errorMessage = "Hubo un problema al enviar el formulario. Por favor, intenta de nuevo más tarde.";
    });
}
---

<!-- El formulario en HTML -->
<form id="contactForm">
  <div class="mb-4">
    <label for="fullName" class="block text-sm font-medium text-gray-700">Nombre y Apellido:</label>
    <input id="fullName" name="fullName" type="text" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required />
  </div>

  <div class="mb-4">
    <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono:</label>
    <input id="phone" name="phone" type="tel" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required />
  </div>

  <div class="mb-4">
    <label for="email" class="block text-sm font-medium text-gray-700">Correo electrónico:</label>
    <input id="email" name="email" type="email" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required />
  </div>

  <div class="mb-4">
    <label for="branch" class="block text-sm font-medium text-gray-700">Seleccione una sucursal:</label>
    <select id="branch" name="branch" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
      <option value="" disabled selected>Selecciona una opción</option>
      <option value="Resistencia">Resistencia</option>
      <option value="Sáenz Peña">Sáenz Peña</option>
      <option value="Charata">Charata</option>
    </select>
  </div>

  <div class="mb-4">
    <label for="model" class="block text-sm font-medium text-gray-700">Seleccione un modelo:</label>
    <select id="model" name="model" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required>
      <option value="" disabled selected>Selecciona un modelo</option>
      <option value="Yaris">Yaris</option>
      <option value="Corolla">Corolla</option>
      <option value="Hilux">Hilux</option>
    </select>
  </div>

  <div class="mb-4">
    <label for="date" class="block text-sm font-medium text-gray-700">Seleccione una fecha:</label>
    <input id="date" name="date" type="date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" required />
  </div>

  <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
    Enviar
  </button>

  <!-- Mostrar mensajes de error o éxito -->
  {errorMessage && <p class="mt-4 text-red-600">{errorMessage}</p>}
  {successMessage && <p class="mt-4 text-green-600">{successMessage}</p>}
</form>

<script is:inline>
  // Agregar el evento 'submit' al formulario
  document.getElementById('contactForm').addEventListener('submit', handleSubmit);
</script>
